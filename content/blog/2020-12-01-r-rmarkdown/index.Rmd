---
title: "Hello R Markdown"
author: "Frida Gomam"
date: 2020-12-01T21:13:14-05:00
categories: ["R"]
tags: ["R Markdown", "plot", "regression"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

```{r, include=F}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(gganimate)
theme_set(theme_bw())
```


# R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

You can embed an R code chunk like this:

```{r cars}
summary(cars)
fit <- lm(dist ~ speed, data = cars)
fit
```

# Including Plots

You can also embed plots. See Figure \@ref(fig:pie) for example:

```{r pie, fig.cap='A fancy pie chart.', tidy=FALSE}
par(mar = c(0, 1, 0, 1))
pie(
  c(280, 60, 20),
  c('Sky', 'Sunny side of pyramid', 'Shady side of pyramid'),
  col = c('#0292D8', '#F7EA39', '#C4B632'),
  init.angle = -50, border = NA
)
```




Here I generate 8 points distributed evenly on the unit circle.
```{r}
circle <- tibble(theta = pi * seq(0, 7/4, length.out = 8),
                 x = cos(theta),
                 y = sin(theta))
ggplot(circle, aes(x, y)) +
  geom_point() +
  coord_equal()
```

We see that any line passing through the origin and one of the 8 points can be the space spanned by the principal component. To verify:
```{r}
prcomp(circle[, c("x", "y")])
```

The two principal components span the x axis and the y axis respectively, with the same variance explained. Due to symmetry, $y = x$ should also have the same variance explained, so is $y = -x$.

Then I want to project these points on different lines passing through the origin, so I write a function the generate the projections in $\mathbb R^2$. 
```{r}
# For projection matrix multiplication
circle_mat <- as.matrix(circle[, c("x", "y")])
```

```{r}
# x, y: x and y coordinates of unit vector on which points are to be projected
# m: matrix with columns x and y, coordinates of points to be projected
# Output: Tibble with colums x_proj and y_proj, the x and y coordinates of projected points
project_pts <- function(x, y, m) {
  # Projection matrix
  new_basis <- c(x, y)
  P <- new_basis %*% t(new_basis)
  # Projection
  proj <- m %*% t(P)
  colnames(proj) <- c("x_proj", "y_proj")
  return(as_tibble(proj))
}
```

Now I project each of the 8 points to each version of the principal component, each spans a line passing through the origin and one of the 8 points on the circle.
```{r}
# Do the projection
projections <- circle %>% 
  mutate(group = seq_along(theta),
         projs = map2(x, y, project_pts, m = circle_mat),
         # Original point corresponding to projected coordinates
         origs = map(theta, ~ setNames(circle[, c("x", "y")], c("x_orig", "y_orig")))) %>% 
  rename(theta_proj = theta) %>% 
  select(-x, -y) %>% 
  unnest(projs, origs)
```

Time to animate! The `group` aesthetics here is to prevent interpolation between states, which obscures the fact that the projections are the same thing rotated.
```{r}
ggplot(projections, aes(x_proj, y_proj)) +
  geom_line(aes(group = group), size = 0.3) +
  geom_segment(aes(xend = x_orig, yend = y_orig, group = group), 
               linetype = 2, color = "gray") +
  geom_point(aes(group = group), shape = 8, color = "cornflowerblue") +
  transition_states(theta_proj) +
  geom_point(data = circle, aes(x, y)) +
  coord_equal()
```

Indeed, it looks like the whole thing is a rotating rigid body.

```{r, echo=T}
p <- ggplot(cars, aes(x = speed, y = dist))+
  geom_point()

p

```
